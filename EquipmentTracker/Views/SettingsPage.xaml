<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:EquipmentTracker.ViewModels"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="EquipmentTracker.Views.SettingsPage"
             x:DataType="vm:SettingsViewModel"
             Title="{Binding Title}"
             BackgroundColor="White">

    <ContentPage.Resources>
        <toolkit:InvertedBoolConverter x:Key="InvertedBoolConverter" />
    </ContentPage.Resources>

    <ScrollView>
        <VerticalStackLayout HorizontalOptions="Center" Padding="0,10,0,20" Spacing="15" >

            <Frame BorderColor="{Binding StatusColor}" BackgroundColor="White" Padding="15"  HorizontalOptions="Center">
                <Label Text="{Binding StatusText}" 
                       TextColor="{Binding StatusColor}" 
                       FontSize="Large" 
                       FontAttributes="Bold" 
                       HorizontalOptions="Center"/>
            </Frame>

            <Frame BorderColor="Gray" Padding="15" WidthRequest="500" >
                <VerticalStackLayout Spacing="10">
                    <Label Text="VeritabanÄ± GiriÅŸ Bilgileri (MySQL)" FontSize="Medium" FontAttributes="Bold" TextColor="Black"/>

                    <VerticalStackLayout>
                        <Label Text="Sunucu IP / Host:" TextColor="White" FontSize="Micro"/>
                        <Entry Text="{Binding ServerIp}" 
                               IsEnabled="{Binding IsInputsEnabled}"
                               Placeholder="46.202.xxx.xxx veya mysql.hostinger..." 
                               TextColor="White"
                               Background="Black"
                               BackgroundColor="{Binding IsInputsEnabled, Converter={toolkit:BoolToObjectConverter TrueObject=Transparent, FalseObject=#EEEEEE}}"/>
                    </VerticalStackLayout>

                    <VerticalStackLayout>
                        <Label Text="VeritabanÄ± AdÄ± (DB Name):" TextColor="White" FontSize="Micro"/>
                        <Entry Text="{Binding DbName}" 
                               IsEnabled="{Binding IsInputsEnabled}"
                               Placeholder="u993098094_TrackerDB" 
                               TextColor="White"
                               Background="Black"
                               BackgroundColor="{Binding IsInputsEnabled, Converter={toolkit:BoolToObjectConverter TrueObject=Transparent, FalseObject=#EEEEEE}}"/>
                    </VerticalStackLayout>

                    <VerticalStackLayout>
                        <Label Text="VeritabanÄ± KullanÄ±cÄ±sÄ±:" TextColor="White" FontSize="Micro"/>
                        <Entry Text="{Binding DbUser}" 
                               IsEnabled="{Binding IsInputsEnabled}"
                               Placeholder="u993098094_trackeruser" 
                               TextColor="White" 
                               Background="Black"
                               
                               BackgroundColor="{Binding IsInputsEnabled, Converter={toolkit:BoolToObjectConverter TrueObject=Transparent, FalseObject=#EEEEEE}}"/>
                    </VerticalStackLayout>

                    <VerticalStackLayout>
                        <Label Text="Åžifre:" TextColor="White" FontSize="Micro"/>
                        <Entry Text="{Binding DbPassword}" 
                               IsEnabled="{Binding IsInputsEnabled}"
                               IsPassword="True" 
                               TextColor="White"
                               Background="Black"
                               
                               BackgroundColor="{Binding IsInputsEnabled, Converter={toolkit:BoolToObjectConverter TrueObject=Transparent, FalseObject=#EEEEEE}}"/>
                    </VerticalStackLayout>

                    <Grid ColumnDefinitions="*">
                        <Button Text="VERÄ°TABANINA BAÄžLAN VE KAYDET" 
                                Command="{Binding ConnectDatabaseCommand}" 
                                IsVisible="{Binding IsConnected, Converter={StaticResource InvertedBoolConverter}}"
                                BackgroundColor="#2196F3" 
                                FontAttributes="Bold" 
                                HeightRequest="45"/>

                        <Button Text="VERÄ°TABANI BAÄžLANTISINI KES" 
                                Command="{Binding DisconnectDatabaseCommand}" 
                                IsVisible="{Binding IsConnected}"
                                BackgroundColor="#D32F2F" 
                                FontAttributes="Bold" 
                                HeightRequest="45"/>
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <Frame BorderColor="Gray" Padding="15" WidthRequest="500" >
                <VerticalStackLayout Spacing="10">
                    <Label Text="Dosya Sunucusu (FTP) AyarlarÄ±" FontSize="Medium" FontAttributes="Bold" TextColor="Black"/>
                    <Label Text="DosyalarÄ±n sunucuda tutulacaÄŸÄ± alan." TextColor="Gray" FontSize="Micro"/>

                    <VerticalStackLayout>
                        <Label Text="FTP Sunucu (Host):" TextColor="Gray" FontSize="Micro"/>
                        <Entry Text="{Binding FtpHost}" 
                               IsEnabled="{Binding IsFtpInputsEnabled}"
                               Placeholder="ftp://46.202.xxx.xxx" 
                               TextColor="White"
                               BackgroundColor="{Binding IsFtpInputsEnabled, Converter={toolkit:BoolToObjectConverter TrueObject=Transparent, FalseObject=#EEEEEE}}"/>
                    </VerticalStackLayout>

                    <VerticalStackLayout>
                        <Label Text="FTP KullanÄ±cÄ± AdÄ±:" TextColor="Gray" FontSize="Micro"/>
                        <Entry Text="{Binding FtpUser}" 
                               IsEnabled="{Binding IsFtpInputsEnabled}"
                               Placeholder="u993098094.ftpuser" 
                               TextColor="White"
                               BackgroundColor="{Binding IsFtpInputsEnabled, Converter={toolkit:BoolToObjectConverter TrueObject=Transparent, FalseObject=#EEEEEE}}"/>
                    </VerticalStackLayout>

                    <VerticalStackLayout>
                        <Label Text="FTP Åžifre:" TextColor="Gray" FontSize="Micro"/>
                        <Entry Text="{Binding FtpPassword}" 
                               IsEnabled="{Binding IsFtpInputsEnabled}"
                               IsPassword="True" 
                               TextColor="White"
                               BackgroundColor="{Binding IsFtpInputsEnabled, Converter={toolkit:BoolToObjectConverter TrueObject=Transparent, FalseObject=#EEEEEE}}"/>
                    </VerticalStackLayout>

                    <Grid ColumnDefinitions="*">
                        <Button Text="FTP'YE BAÄžLAN VE KAYDET" 
                                Command="{Binding ConnectFtpCommand}" 
                                IsVisible="{Binding IsFtpConnected, Converter={StaticResource InvertedBoolConverter}}"
                                BackgroundColor="#FF9800" 
                                FontAttributes="Bold" 
                                HeightRequest="45"/>

                        <Button Text="FTP BAÄžLANTISINI KES" 
                                Command="{Binding DisconnectFtpCommand}" 
                                IsVisible="{Binding IsFtpConnected}"
                                BackgroundColor="#D32F2F" 
                                FontAttributes="Bold" 
                                HeightRequest="45"/>
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <Frame BorderColor="Gray" Padding="15" WidthRequest="500" IsVisible="{Binding IsAdminUser}">
                <VerticalStackLayout Spacing="10">
                    <Label Text="Yerel Ã‡alÄ±ÅŸma KlasÃ¶rÃ¼ (Cache)" FontSize="Medium" FontAttributes="Bold" TextColor="Black"/>

                    <VerticalStackLayout>
                        <Label Text="Dosya Yolu:" TextColor="Gray" FontSize="Micro"/>
                        <Grid ColumnDefinitions="*, Auto" ColumnSpacing="5">
                            <Entry Grid.Column="0" 
                                   Text="{Binding AttachmentPath}" 
                                   IsEnabled="True" 
                                   Placeholder="HenÃ¼z ayarlanmadÄ±..." 
                                   TextColor="Black"
                                   BackgroundColor="White"/>

                            <Button Grid.Column="1" 
                                    Text="ðŸ“‚" 
                                    IsEnabled="True"
                                    Command="{Binding SelectAttachmentPathCommand}" 
                                    BackgroundColor="Gray" 
                                    TextColor="White"
                                    WidthRequest="50"
                                    Padding="0"/>
                        </Grid>
                    </VerticalStackLayout>

                    <Button Text="KONUMU KAYDET (YEREL)" 
                            Command="{Binding SaveAttachmentPathCommand}" 
                            BackgroundColor="#2196F3" 
                            FontAttributes="Bold" 
                            HeightRequest="45"/>

                    <Label Text="* Bu ayar sadece bu bilgisayardaki Ã¶nbellek klasÃ¶rÃ¼nÃ¼ belirler."
                           TextColor="Gray" FontSize="Micro"/>
                </VerticalStackLayout>
            </Frame>

            <Button Text="OTURUMU KAPAT" 
                    Command="{Binding LogoutCommand}" 
                    IsVisible="{Binding IsUserLoggedIn}"
                    BackgroundColor="Red"
                    TextColor="White"
                    Margin="0,20,0,100"
                    HeightRequest="45"
                    WidthRequest="350" />
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>